# {{ ansible_managed }}

# Full configuration options can be found at https://www.vaultproject.io/docs/configuration


ui = {{ vault_ui_enable | string | lower }}

#mlock = true
#disable_mlock = true

storage "file" {
  path = "/opt/vault/data"
}

#storage "consul" {
#  address = "127.0.0.1:8500"
#  path    = "vault"
#}

{% for t in vault_tcp_listeners -%}
listener "tcp" {
  address = "{{ t.vault_address }}:{{ t.vault_port }}"
  {% if (t.vault_tls_enable | bool) -%}
  {% if t.vault_tls_cert_file is defined -%}
  tls_cert_file = "{{ t.vault_tls_cert_file }}"
  {% endif -%}
  {% if t.vault_tls_key_file is defined -%}
  tls_cert_file = "{{ t.vault_tls_key_file }}"
  {% endif -%}
  {%- endif -%}

}
{% endfor %}

# HTTP listener
#listener "tcp" {
#  address = "127.0.0.1:8200"
#  tls_disable = 1
#}

# HTTPS listener
#listener "tcp" {
#  address       = "0.0.0.0:8200"
#  tls_cert_file = "/opt/vault/tls/tls.crt"
#  tls_key_file  = "/opt/vault/tls/tls.key"
#}

# Enterprise license_path
# This will be required for enterprise as of v1.8
{% if vault_license_file is not none %}
license_path = "{{ vault_license_path }}"
{% endif %}

# Example AWS KMS auto unseal
#seal "awskms" {
#  region = "us-east-1"
#  kms_key_id = "REPLACE-ME"
#}

# Example HSM auto unseal
#seal "pkcs11" {
#  lib            = "/usr/vault/lib/libCryptoki2_64.so"
#  slot           = "0"
#  pin            = "AAAA-BBBB-CCCC-DDDD"
#  key_label      = "vault-hsm-key"
#  hmac_key_label = "vault-hsm-hmac-key"
#}
